<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.itwillbs.project_movie.mapper.BookMapper2">
	
	<select id="selectMovieList" resultType="movie">
		SELECT *
		FROM movie
		<choose>
			<when test="movie_code.equals('')">
				WHERE movie_code IN (SELECT movie_code
									 FROM schedule
									 WHERE DATE_FORMAT(start_time, '%Y년 %m월 %d') = #{start_time}
									 AND start_time > NOW())
									 GROUP BY movie_code
			</when>
			<otherwise>
				WHERE movie_code = #{movie_code}
			</otherwise>
		</choose>
	</select>
	
	<select id="selectScheduleList" resultType="schedule">
		SELECT *
		FROM schedule
		WHERE DATE_FORMAT(start_time, '%Y년 %m월 %d') = #{start_time}
		AND start_time > now()
		<if test="!movie_code.equals('')">
			AND movie_code = #{movie_code}
		</if> 
	</select>
</mapper>















